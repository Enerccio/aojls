<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=640">

    <link rel="stylesheet" href="stylesheets/core.css" media="screen">
    <link rel="stylesheet" href="stylesheets/mobile.css" media="handheld, only screen and (max-device-width:640px)">
    <link rel="stylesheet" href="stylesheets/github-light.css">

    <script type="text/javascript" src="javascripts/modernizr.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="javascripts/headsmart.min.js"></script>
    <script type="text/javascript">
      $(document).ready(function () {
        $('#main_content').headsmart()
      })
    </script>
    <title>Aojls by Enerccio</title>
  </head>

  <body>
    <a id="forkme_banner" href="https://github.com/Enerccio/aojls">View on GitHub</a>
    <div class="shell">

      <header>
        <span class="ribbon-outer">
          <span class="ribbon-inner">
            <h1>Aojls</h1>
            <h2>&quot;all other json libraries suck&quot; - simple to use JSON parser/generator library</h2>
          </span>
          <span class="left-tail"></span>
          <span class="right-tail"></span>
        </span>
      </header>

      <section id="downloads">
        <span class="inner">
          <a href="https://github.com/Enerccio/aojls/zipball/master" class="zip"><em>download</em> .ZIP</a><a href="https://github.com/Enerccio/aojls/tarball/master" class="tgz"><em>download</em> .TGZ</a>
        </span>
      </section>


      <span class="banner-fix"></span>


      <section id="main_content">
        <h1>
<a id="aojls" class="anchor" href="#aojls" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>AOJLS</h1>

<p>AOJLS - "All other JSON libraries suck" is JSON parsing/generating library that is not aiming for speed or efficiency, but instead aims for programmers comfort. With this in mind, AOJLS is built on these principles:</p>

<ol>
<li>Creating simple and complex JSON values should be easy and intuitive</li>
<li>Programmer should not be bothered to track liveness of all JSON values manually</li>
<li>If there is any error when working with JSON values, it should be possible to defer error checking until next logical step</li>
</ol>

<p>To fulfill these principles, AOJLS employs these techniques:</p>

<ul>
<li>easy to use api for value creation and usage</li>
<li>all values require context and their liveness is bound by it</li>
<li>in case of failure, context is marked as such and all operations on the JSON data continue to work in a fashion that they will not cause undefined behavior (however returned values might be sentinel values)</li>
</ul>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h2>

<p>AOJLS is released under BSD 3.0 license. You can freerly use or modify this code, as long as you provide attribution. Author is, however, not liable for any damages for using this code.</p>

<h2>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Requirements</h2>

<p>AOJLS only requires C99 and nothing else. From C library, it only requires these headers:</p>

<ul>
<li><code>string.h</code></li>
<li><code>stdio.h</code></li>
<li><code>stdlib.h</code></li>
<li><code>stdbool.h</code></li>
<li><code>setjmp.h</code></li>
<li><code>float.h</code></li>
</ul>

<h2>
<a id="example-usage" class="anchor" href="#example-usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example usage</h2>

<h3>
<a id="value-creation" class="anchor" href="#value-creation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Value creation</h3>

<p>For all operations except deserialization (and even there, if we want), you need first to create instance of <code>aojls_ctx_t</code>:</p>

<div class="highlight highlight-source-c"><pre>    <span class="pl-c1">aojls_ctx_t</span>* ctx = json_make_context(); <span class="pl-c">// creates new context, or returns NULL on failure</span></pre></div>

<p>After creating context, we can create other JSON values:</p>

<div class="highlight highlight-source-c"><pre>    json_object* root = json_make_object(ctx);             <span class="pl-c">// creates empty JSON object {}</span>
    json_array* array = json_make_array(ctx);              <span class="pl-c">// creates empty JSON array []</span>
    json_string* string = json_from_string(ctx, <span class="pl-s"><span class="pl-pds">"</span>foo<span class="pl-pds">"</span></span>);    <span class="pl-c">// creates JSON string "foo"</span>
    json_number* number = json_from_number(ctx, <span class="pl-c1">20</span>);       <span class="pl-c">// creates JSON number 20</span>
    json_boolean* boolean = json_from_boolean(ctx, <span class="pl-c1">false</span>); <span class="pl-c">// creates JSON false value </span></pre></div>

<h3>
<a id="objectarray-filling" class="anchor" href="#objectarray-filling" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Object/Array filling</h3>

<p>Both objects and arrays are one-way mutable. You can push new values into them, but you can't delete values already in them. For objects, you can push in multiple equal keys, and it will produce JSON that can be deserialized by AOJLS, however, might be invalid for other deserializers.</p>

<p>To push new key-value pair into object, use:</p>

<div class="highlight highlight-source-c"><pre>    <span class="pl-en">json_object_add</span>(object, <span class="pl-s"><span class="pl-pds">"</span>foo<span class="pl-pds">"</span></span>, (<span class="pl-c1">json_value_t</span>*)json_value);</pre></div>

<p>To push new value into array, use:</p>

<div class="highlight highlight-source-c"><pre>    <span class="pl-en">json_array_add</span>(array, (<span class="pl-c1">json_value_t</span>*)json_value);</pre></div>

<p><strong>Warning</strong>: You may create nested objects with circles, however any attempt to serialize those will end up with stack overflow!</p>

<p>For more operations on objects/arrays see API.</p>

<h3>
<a id="serialization" class="anchor" href="#serialization" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Serialization</h3>

<p>To serialize some JSON value, simply use <code>aojls_serialize</code>. This function takes <code>json_value_t</code> reference and reference to <code>aojls_serialization_prefs</code> which may be <code>NULL</code>, in which case default preferences will be used. <code>aojls_serialize</code> returns <code>char*</code> with result, <strong>if</strong> you use default preferences or you do not specify custom writer. Otherwise, or in case of failure, it returns <code>NULL</code>. If it does return non<code>NULL</code> value, you must deallocate it via <code>free</code> if you are done using it. In case of failure, if you provided preferences, it will also put <code>false</code> into <code>aojls_serialization_prefs.success</code>.</p>

<p>Example serialization:</p>

<div class="highlight highlight-source-c"><pre>    aojls_serialization_prefs p;
    p.eol = <span class="pl-c1">NULL</span>;
    p.pretty = <span class="pl-c1">false</span>;
    p.offset_per_level = <span class="pl-c1">4</span>;
    p.writer = <span class="pl-c1">NULL</span>;
    p.number_formatter = <span class="pl-c1">NULL</span>;

    <span class="pl-k">char</span>* result = aojls_serialize((<span class="pl-c1">json_value_t</span>*)root, &amp;p);</pre></div>

<p>For more options about serialization, see API.</p>

<h3>
<a id="deserialization" class="anchor" href="#deserialization" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Deserialization</h3>

<p>If you need to deserialize, you either can provide a context in which new deserialized objects will residue, or deserialization will make new context for you. Use function <code>aojls_deserialize</code>, which takes three parameters, a <code>char*</code> string (does not need to be <code>\0</code> terminated), <code>size_t</code> size of previous string and <code>aojls_deserialization_prefs</code>. <code>aojls_deserialization_prefs</code> may be <code>NULL</code>, in which case default preferences are used. If you do not specify custom reader, provided string must be valid and length must be correct, otherwise string may be <code>NULL</code>. <code>aojls_deserialize</code> returns reference to <code>aojls_ctx_t</code> (either new, or provided). You can use <code>json_context_get_result</code> to get the resulting deserialized object from this context. In case of failure, <code>json_context_get_result</code> will return NULL and provided preferences, if any, will contain error description. </p>

<p>Example deserialization:</p>

<div class="highlight highlight-source-c"><pre>    aojls_deserialization_prefs dp;
    <span class="pl-en">memset</span>(&amp;dp, <span class="pl-c1">0</span>, <span class="pl-k">sizeof</span>(aojls_deserialization_prefs));

    <span class="pl-c1">aojls_ctx_t</span>* context = aojls_deserialize(source, strlen(source), &amp;dp);
    <span class="pl-c1">json_value_t</span>* result = json_context_get_result(context);</pre></div>

<p>For more options about deserialization (including providing context yourself), see API. </p>

<h3>
<a id="value-liveness--memory-leak-prevention" class="anchor" href="#value-liveness--memory-leak-prevention" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Value liveness &amp; memory leak prevention</h3>

<p>All JSON values's memory is tracked by the context they residue in. If you want to free all the memory, simply use <code>json_free_context</code> as in:</p>

<div class="highlight highlight-source-c"><pre>    <span class="pl-en">json_free_context</span>(context); <span class="pl-c">// after this point, all references to JSON values held in this context</span>
                                <span class="pl-c">// become invalid and dangling!</span></pre></div>

<p>When providing string keys for objects, they are copied upon call and copies are tracked by context, so you can do whatever you want with strings after the call, ie:</p>

<div class="highlight highlight-source-c"><pre>    <span class="pl-k">char</span>* key = (<span class="pl-k">char</span>*)malloc(<span class="pl-k">sizeof</span>(<span class="pl-k">char</span>)*<span class="pl-c1">4</span>); <span class="pl-c">// allocate 4 bytes</span>
    <span class="pl-en">memcpy</span>(key, <span class="pl-s"><span class="pl-pds">"</span>foo<span class="pl-pds">"</span></span>, <span class="pl-c1">4</span>);                     <span class="pl-c">// copy foo and \0 into key</span>
    <span class="pl-en">json_object_add</span>(object, key, json_value);  <span class="pl-c">// at this point, key is copied </span>
                                               <span class="pl-c">// and stored in the context</span>
    <span class="pl-en">free</span>(key);                                 <span class="pl-c">// valid operation</span></pre></div>

<p>String passed into deserialization is not modified and can be freed/modified after deserialization is finished. String returned from serialization needs to be freed by programmer. </p>

<h3>
<a id="error-checking" class="anchor" href="#error-checking" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Error checking</h3>

<p>All functions in AOJLS give some way of error checking, either by sentinel value or via function call/validity pass-value. However, you only need to do it when absolutely necessary. All operations must succeed in some way and cannot cause any failure in AOJLS. Therefore, for instance, if you are building some deeply nested JSON value, you can first build that structure completely, and at the end, check whether there were any issues. You can do that via <code>json_context_error_happened</code> at any time. Deserialization will also add error string with explanation in <code>aojls_deserialization_prefs.error</code>. Serialization will instead announce success via setting <code>aojls_serialization_prefs.success</code> to <code>true</code>.</p>

<h2>
<a id="api" class="anchor" href="#api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>API</h2>

<p>Autogenerated documentation is available here: <a href="http://enerccio.github.io/aojls/doc/html/d3/de7/aojls_8h.html">http://enerccio.github.io/aojls/doc/html/d3/de7/aojls_8h.html</a></p>

<h2>
<a id="errors--problems" class="anchor" href="#errors--problems" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Errors &amp; Problems</h2>

<p>If you find any problems or errors, feel free to submit new issue, if there is no such issue already submitted.</p>
      </section>

      <footer>
        <span class="ribbon-outer">
          <span class="ribbon-inner">
            <p>this project by <a href="https://github.com/Enerccio">Enerccio</a> can be found on <a href="https://github.com/Enerccio/aojls">GitHub</a></p>
          </span>
          <span class="left-tail"></span>
          <span class="right-tail"></span>
        </span>
        <p>Generated with <a href="https://pages.github.com">GitHub Pages</a> using Merlot</p>
        <span class="octocat"></span>
      </footer>

    </div>

    
  </body>
</html>
